<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="hakyll">
    <meta name="author" content="$author$">
    <meta name="description" content="$description$">
    <meta name="keywords" content="$tags$">
    <meta name="dc.date.issued" content="$created$">
    <meta name="dcterms.modified" content="$modified$">
    <link rel="canonical" href="https://www.gwern.net$url$">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>$title$ - Gwern.net</title>

    <!-- fetch the title & body fonts & logo immediately to avoid re-rendering -->
    <link rel="preload" href="/static/font/SourceSerifPro-BASIC-Regular.ttf"  as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="/static/font/SourceSerifPro-BASIC-Semibold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="/images/logo-smooth.svg" as="image" type="image/svg+xml">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/static/css/default.css" />
    <link rel="stylesheet" type="text/css" href="/static/css/fonts.css" />

    <!-- JS library for Tufte-style 'sidenotes' (footnotes popped into the left & right margins on sufficiently-wide screens); much more convenient than floating footnotes & endnotes -->
    <script src="/static/js/sidenotes.js" async></script> <!-- since sidenotes visibly render, unlike the other JS libs, we prioritize its loading in the head -->
    <!-- floating footnotes; see http://ignorethecode.net/blog/2010/04/20/footnotes/ -->
    <script src="/static/js/footnotes.js" defer></script>

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Site-wide global ATOM/RSS Feed (all edits)" />

    <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.png" />
  </head>
  <body class="$safeURL$ $cssExtension$">

    <main>
      <div id="sidebar">
        <a id="logo" href="/index" title="index: categorized list of articles">
          <img alt="Gwern.net Site Logo [a Gothic/Fraktur blackletter capital G]" src="/images/logo-smooth.svg">
        </a>
        <div id="sidebar-links">
        <a class="home" href="/index" title="index: categorized list of articles">Home</a>
        <a class="site" href="/About" title="Site ideals, source, content, traffic, examples, license">Site</a>
        <a class="links" href="/Links" title="Who am I online, what have I done, what am I like? Contact information; sites I use; things I've worked on">Me</a>
        <a class="new" href="/Changelog" title="What's new or updated">New:</a>
        <a class="mail" href="https://tinyletter.com/gwern" title="Monthly mailing list: newsletter signup form"><i>mail</i></a>
        <a class="rss" href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM/RSS feed of all changes"><i>rss</i></a>
        <a class="r_gwern" href="https://www.reddit.com/r/gwern/" title="Gwern subreddit: link-sharing &amp; commentary (the links typically are included in the monthly newsletter)"><em><code>/r/gwern</code></em></a>
        <a class="patreon" href="https://www.patreon.com/gwern" title="Link to Patreon donation profile to support my writing">support on<br><span>PATREON</span></a>
        </div>
      </div>

      <!-- Banner ad placeholder: TOOD: replace with PSA telling non-adblock users how to get adblock? -->
      <div id="adsense">
      </div>

      <header>
        <h1>$title$</h1>
      </header>

      <article>

        <noscript>[For support of table-sorting/collapsible-sections/image-zooms/floating-footnotes/Disqus-comments/quote-insertion, please enable JavaScript.]</noscript>

        <div id="page-metadata">
          <p><span id="abstract"><em>$description$</em></span>
            <br />
            topics: <span id="tags"><em>$tagsHTML$</em></span>
            <br />
            <span id="page-created">created: <em>$created$</em></span>;  <span id="last-modified">modified: <em>$modified$</em></span>; <span id="version">status: <em>$status$</em></span>; <span id="epistemological-status"><a href="/About#confidence-tags" title="Explanation of 'confidence' metadata">confidence:</a> <em>$confidence$</em></span>; <span id="importance"><a href="/About#importance-tags" title="Explanation of 'importance' metadata">importance:</a> <em>$importance$</em></span>
          </p>
          <hr>
        </div>

        $body$

      </article>
    </main>

    <div id="footer">
      <p><a href="https://docs.google.com/forms/d/17cNf0ohMHKeTwmUM_V_hDVkirjsf8HLMWsJco8gt2Eg/viewform"><em>Submit Anonymous Feedback</em></a></p>
    </div>

    <!-- dependency for tablesorter -->
    <script src="/static/js/jquery-1.7.1.min.js" defer></script>
    <!-- http://tablesorter.com/docs/ ; requires JQuery -->
    <script src="/static/js/tablesorter.js" defer></script>

    <!-- JS library for clickable/zoomable images, for images larger than can be displayed in the body: http://share.obormot.net/misc/gwern/image-focus.js http://share.obormot.net/misc/gwern/image-focus.css -->
    <script src="/static/js/image-focus.js" defer></script>

    <!-- Async load Google Analytics  -->
    <script id="googleAnalytics" src="https://www.googletagmanager.com/gtag/js?id=UA-18912926-1" async></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-18912926-1');
    </script>

    <!-- Comments courtesy of Disqus -->
    <div id="comments">
      <div id="disqus_thread"></div>
      <script>
         var disqus_shortname = 'gwern';
         (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
      </script>
      <noscript><p>Enable JavaScript for Disqus comments</p></noscript>
    </div>

    <!-- Misc JS: 1. Collapsed sections: insert a toggle to expand them; 2. cover source-code block listings too (for large R sections especially); 3. insert spans around <q> quotes to fiddle with doublequotes -->
    <script>
	/***********/
	/* HELPERS */
	/***********/

	/*	Run the given function immediately if the page is already loaded, or add
		a listener to run it as soon as the page loads.
		*/
	function doWhenPageLoaded(f) {
		if (document.readyState == "complete")
			f();
		else
			window.addEventListener("load", f);
	}

	/*=--------=*/
	/*= Tables =*/
	/*=--------=*/

	/*	Expands all tables whose wrapper block is marked with class "full-width"
		to span the viewport (minus a specified margin on both sides).
		*/
	function expandFullWidthTables() {
		let fullWidthTableMargin = "2.5ch";
		let pageWidth = document.querySelector("html").clientWidth;

		/*	Find all full-width tables; set their position and size.
			*/
		document.querySelectorAll(".tableWrapper.full-width").forEach(fullWidthTable => {
			fullWidthTable.removeAttribute("style");
			fullWidthTable.style.left = `calc($${(fullWidthTable.getBoundingClientRect().left * -1) + "px"} + $${fullWidthTableMargin})`;
			fullWidthTable.style.width = `calc($${pageWidth + "px"} - (2 * $${fullWidthTableMargin}))`;
		});

		/*	If sidenotes exist, update sidenote positions.
			*/
		requestAnimationFrame(() => {
			if (typeof window.GW == "undefined" ||
				typeof GW.sidenotes == "undefined" ||
				GW.sidenotes.viewportWidthBreakpointMediaQuery.matches == true ||
				GW.sidenotes.sidenoteDivs.length == 0)
				return;

				updateSidenotePositions();
		});
	}

	/*=-----------------=*/
	/*= Figure captions =*/
	/*=-----------------=*/

	/*	Returns an array of objects each with two properties: 'media' (which
		is the image or video element) and 'caption' (which is the figcaption
		element). These are all the captioned media elements on the page.
		*/
	function getAllCaptionedMedia() {
		return Array.prototype.map.call(document.querySelectorAll("figure"), figure => {
			let media = figure.querySelector("img") || figure.querySelector("video");
			let caption = figure.querySelector("figcaption");
			return { media: media, caption: caption };
		}).filter(captionedMedia => captionedMedia.media && captionedMedia.caption);
	}

	/*	Sets minimum width of all captions to the width of their associated
		media (image or video) element.
		*/
	function setCaptionsMinimumWidth() {
		getAllCaptionedMedia().forEach(captionedMedia => {
			//	Get the caption wrapper span.
			let wrapper = captionedMedia.caption.closest(".caption-wrapper");
			//	Set wrapper minimum width to width of media element.
			wrapper.style.minWidth = captionedMedia.media.clientWidth + "px";
		});
	}

	/*********/
	/* SETUP */
	/*********/

	/*	Wrap each table in a div.tableWrapper (for layout purposes).
		*/
	document.querySelectorAll("table").forEach(table => {
		if (table.parentElement.tagName == "DIV" && table.parentElement.children.length == 1)
			table.parentElement.classList.toggle("tableWrapper", true);
		else
			table.outerHTML = "<div class='tableWrapper'>" + table.outerHTML + "</div>";
	});

	/*	Expand full-width tables, and add a listener to recompute their size and
		position upon window resize.
		*/
	doWhenPageLoaded(expandFullWidthTables);
	window.addEventListener("resize", expandFullWidthTables);

	/*	Unwrap pre.sourceCode blocks from their extraneous containing divs.
		*/
	document.querySelectorAll("div.sourceCode").forEach(scd => {
		scd.outerHTML = scd.innerHTML;
	});

	/*	Round heights of code blocks down to the nearest pixel, to correct for
		layout aberrations that cut off the bottom border.
		*/
	doWhenPageLoaded(() => {
		document.querySelectorAll("pre code").forEach(codeBlock => {
			codeBlock.style.height = parseInt(getComputedStyle(codeBlock).height) + "px";
		});
	});

	/*	Inject disclosure buttons and otherwise prepare the collapse blocks.
		*/
	document.querySelectorAll(".collapse").forEach(collapseBlock => {
		let disclosureButtonHTML = "<input type='checkbox' class='disclosure-button'>";
		if (collapseBlock.tagName == "SECTION") {
			//  Inject the disclosure button.
			collapseBlock.children[0].insertAdjacentHTML("afterend", disclosureButtonHTML);
		} else {
			//  Construct collapse block wrapper and inject the disclosure button.
			let realCollapseBlock = document.createElement("div");
			realCollapseBlock.classList.add("collapse");
			realCollapseBlock.insertAdjacentHTML("afterbegin", disclosureButtonHTML);
			//  Move block-to-be-collapsed into wrapper.
			collapseBlock.parentElement.insertBefore(realCollapseBlock, collapseBlock);
			collapseBlock.classList.remove("collapse");
			realCollapseBlock.appendChild(collapseBlock);
		}
	});
	/*	Add listeners to toggle ‘expanded’ class of collapse blocks.
		*/
	document.querySelectorAll(".disclosure-button").forEach(disclosureButton => {
		let collapseBlock = disclosureButton.closest(".collapse");
		if (collapseBlock.tagName == "SECTION") {
			disclosureButton.addEventListener("change", (event) => {
				collapseBlock.classList.toggle("expanded", disclosureButton.checked);
			});
		}
	});

	/*	Inject spans to contain curly quotes within <q> elements.
		*/
	document.querySelectorAll("q").forEach(q => {
		let openQuote = `<span class='quote-mark open'>$${q.innerHTML.substring(0, 1)}</span>`;
		let closeQuote = `<span class='quote-mark close'>$${q.innerHTML.substring(q.innerHTML.length - 1)}</span>`;
		q.innerHTML = q.innerHTML.substring(1, q.innerHTML.length - 1);
		if (q.parentElement.tagName == "A" && q.parentElement.childNodes.length == 1) {
			q.parentElement.outerHTML = `$${openQuote}$${q.parentElement.outerHTML}$${closeQuote}`;
		} else {
			q.outerHTML = `$${openQuote}$${q.outerHTML}$${closeQuote}`;
		}
	});

	/*	Wrap all captions in figures in a span.
		*/
	getAllCaptionedMedia().forEach(captionedMedia => {
		//	Wrap the caption in the wrapper span.
		let wrapper = document.createElement("span");
		wrapper.classList.add("caption-wrapper");
		wrapper.appendChild(captionedMedia.caption);

		//	Re-insert the wrapped caption into the figure.
		let figure = captionedMedia.media.closest("figure");
		figure.appendChild(wrapper);
	});

	/*  Set minimum caption box width, and add listener to recalculate on
		window resize.
		*/
	doWhenPageLoaded(setCaptionsMinimumWidth);
	window.addEventListener('resize', setCaptionsMinimumWidth);

	/*	Insert zero-width spaces after problematic characters in links.
		(This is to mitigate justification/wrapping problems.)
		*/
	let problematicCharacters = '/';
	document.querySelectorAll("p a, p a *").forEach(element => {
		element.childNodes.forEach(node => {
		   if (node.childNodes.length > 0) return;
		   node.textContent = node.textContent.replace(new RegExp("(\\w[" + problematicCharacters + "])(\\w)", 'g'), "$$1\u{200B}$$2");
		});
	});

	/*	Rectify straight quotes / apostrophes / etc. in the header and the page metadata.
		TODO: this should be doable in Hakyll at compile-time
		*/
	let textCleanRegexps = [
		// beginning "
		[/([^A-Za-z0-9_\)]|^)"(\S)/, '$$1\u201c$$2'],
		// ending "
		[/(\u201c[^"]*)"([^"]*$$|[^\u201c"]*\u201c)/, '$$1\u201d$$2'],
		// remaining " at end of word
		[/([^0-9])"/, '$$1\u201d'],
		// double quotes
		[/"(.+?)"/, '\u201c$$1\u201d'],
		// beginning '
		[/(\W|^)'(\S)/, '$$1\u2018$$2'],
		// conjunction's possession
		[/([a-z])'([a-z])/, '$$1\u2019$$2'],
		// abbrev. years like '93
		[/(\u2018)([0-9]{2}[^\u2019]*)(\u2018([^0-9]|$$)|$$|\u2019[a-z])/, '\u2019$$2$$3'],
		// ending '
		[/((\u2018[^']*)|[a-z])'([^0-9]|$$)/, '$$1\u2019$$3'],
		// backwards apostrophe
		[/(\B|^)\u2018(?=([^\u2018\u2019]*\u2019\b)*([^\u2018\u2019]*\B\W[\u2018\u2019]\b|[^\u2018\u2019]*$$))/, '$$1\u2019'],
	];
	document.querySelectorAll("header *, #page-metadata *").forEach(element => {
		element.childNodes.forEach(node => {
			if (node.childNodes.length > 0) return;
			textCleanRegexps.forEach(tcr => {
				node.textContent = node.textContent.replace(new RegExp(tcr[0], 'ig'), tcr[1]);
			});
		});
	});
    </script>
  </body>
</html>
